---
layout:     post
title:   针孔相机模型
subtitle:   针孔相机模型
date:       2021-09-22
author:     LXR
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - 针孔相机
    - 小孔成像
---

# 参考文章
书：《视觉SLAM14讲》

# 主要内容
小孔成像：相机将三维世界中的坐标点(单位为米)映射到二维图像平面(单位为像素)的过程。

## 针孔相机模型
![针孔相机模型](/img/camera_model.jpg)

### 内参
相机坐标系：O − x − y − z
物理成像平面： O ′ − x ′ − y ′

O − x − y坐标系下，现实世界的空间点： P_c[X, Y, Z] T
 O ′ − x ′ − y ′坐标系下， 成像点：P ′[X ′ , Y ′ ] T

物理成像平面到小孔的距离为： f (焦距)

为了简化模型,我们把可以成像平面对称到相机前方,和三维空间点一起放在摄像机坐标系的同一侧。
![真实成像平面,对称成像平面,归一化成像平面的图示](/img/three_planes.jpg)

根据三角形相似关系,有:
$$\frac{Z}{f}=\frac{X}{X'}=\frac{Y}{Y'}\tag{1} $$

整理得：
$$X'=f\frac{X}{Z}\\
   Y'=f\frac{Y}{Z}\tag{2}$$
   
像素坐标系通常的定义方式是:原点 o ′ 位于图像的左上角,u 轴向右与 x 轴平行,v轴向下与 y 轴平行。像素坐标系与成像平面之间,相差了一个缩放和一个原点的平移。

我们设像素坐标在 u 轴上缩放了 α 倍,在 v 上缩放了 β 倍。同时,原点平移了 [c x , c y ] T 。那么,P ′ 的坐标与像素坐标 [u, v] T 的关系为:
$${u=\alpha X'+c_x\\
   v=\beta Y'+c_y}\tag{3}$$

把式子(2)代入式子(3)得：
$${u=f_x \frac{X}{Z}+c_x\\
   v=f_y \frac{Y}{Z}+c_y}\\
  f_x =\alpha f\\
  f_y = \beta f \tag{4}$$

其中，f的单位为米，α和β的单位为像素每米，f_x和f_y的单位为像素。

式子(4)的矩阵形式：
![P_c-->P_uv](/img/camera_model_1.jpg)
其中矩阵K称为相机的内参。
如果把这个 1/Z 和 P(X,Y,Z) 进行相乘，就得到了相机坐标系下P的归一化坐标 P = (X/Z, Y/Z, 1)， 它位于相机前方z =1 的平面上。

### 外参
P_c是 P在相机坐标系坐标，P_w是其在世界坐标系下的坐标，可以使用一个旋转矩阵 R和一个平移向量t，将 P_c变换为P_w：
$$ P_c = R P_w + t$$
矩阵形式：
![P_w-->P_c](/img/camera_model_2.jpg)

这个R,t 为就是相机的外部参数。

### 综合外参和内参
![P_w-->P_c-->P_uv](/img/camera_model_3.jpg)

>  1. 首先，世界坐标系下有一个三维点Pw
 2. 若世界坐标系到相机坐标系下的变换为旋转矩阵 R 和平移向量t 组成的变换矩阵 T，那么Pw在相机坐标系下的坐标为 Pc = RPw + t = TPw
 3. 此时的Pc三个分量分别是X, Y, Z，我们需要把它投影到归一化平面Z=1上，这样我们得到了相机坐标系下Pc的归一化坐标 Pc’ = (X/Z, Y/Z, 1)
 4. 用内参矩阵乘以归一化坐标就得到了像素坐标 Puv = K*Pc’
 
## 畸变

### 径向畸变
由透镜形状引起的畸变称之为径向畸变。在针孔模型中,一条直线投影到像素平面上还是一条直线。可是,在实际拍摄的照片中,摄像机的透镜往往使得真实环境中的一条直线在图片中变成了曲线 ¬ 。越靠近图像的边缘,这种现象越明显。由于实际加工制作的透镜往往是中心对称的,这使得不规则的畸变通常径向对称。它们主要分为两大类,桶形畸变和枕形畸变。
![径向畸变](/img/jingxiang_jibian)
对于径向畸变,无论是桶形畸变还是枕形畸变,由于它们都是随着离中心的距离增加而增加。我们可以用一个多项式函数来描述畸变前后的坐标变化:这类畸变可以用和距中心距离有关的二次及高次多项式函数进行纠正

### 切向畸变
除了透镜的形状会引入径向畸变外,在相机的组装过程中由于不能使得透镜和成像面
严格平行也会引入切向畸变。
![切向畸变](/img/qiexiang_jibian)

### 畸变纠正

>  1.  将三维空间点投影到归一化图像平面。设它的归一化坐标为 [x, y] T
 2.  畸变纠正：
$$ x_c = x (1+ k_1 r^2 + k_2 r^4 + k_3 r^6 ) + 2 p_1 x y + p_2(r^2 + 2x^2)\\
  y_c = y(1 + k_1 r^2 +k _2 r^4 + k_3 r^6) + p_1(r^2 + 2 y^2) + 2 p_2 x y$$
3. 将纠正后的点通过内参数矩阵投影到像素平面,得到该点在图像上的正确位置:
$$ u = f_x x_c + c_x\\
   v = f_y y_c + c_y$$

对于畸变较小的图像中心区域,畸变纠正主要是 k 1起作用。而对于畸变较大的边缘区域主要是 k 2 起作用。普通摄像头用这两个系数就能很好
的纠正径向畸变。

在上面的纠正畸变的过程中,我们使用了五个畸变项。实际应用中,可以灵活选择纠正模型,比如只选择 k 1 , p 1 , p 2 这三项等。

